<% layout("layouts/boilerplate"); %>

<style>
  .cart-wrap { max-width: 1100px; margin: 40px auto; display:flex; gap:28px; padding:0 20px; box-sizing:border-box; }
  .cart-items { flex: 1 1 0; background:#fff; padding:20px; border-radius:10px; box-shadow:0 8px 30px rgba(35,49,79,0.06);} 
  .cart-summary { width:320px; min-width:260px; background:#fff; padding:20px; border-radius:10px; box-shadow:0 8px 30px rgba(35,49,79,0.06);} 
  .cart-item { display:flex; gap:16px; align-items:center; padding:14px 0; border-bottom:1px solid rgba(35,49,79,0.06);} 
  .cart-item:last-child { border-bottom:none; }
  .ci-thumb { width:84px; height:84px; border-radius:8px; background:#f3f4f6; display:flex; align-items:center; justify-content:center; overflow:hidden; }
  .ci-thumb img { width:100%; height:100%; object-fit:cover; }
  .ci-body { flex:1 1 auto; }
  .ci-title { font-weight:700; color:#111827; margin-bottom:6px; }
  .ci-meta { color:#6b7280; font-size:0.95rem; }
  .ci-actions { display:flex; gap:8px; align-items:center; }
  .qty-input { width:72px; padding:6px 8px; border-radius:8px; border:1px solid rgba(35,49,79,0.08); }
  .btn-sm { padding:8px 10px; border-radius:8px; border:none; cursor:pointer; }
  .btn-remove { background:#fff; border:1px solid rgba(220,38,38,0.12); color:#dc2626; }
  .btn-update { background:#ff6b35; color:#fff; }
  .summary-row { display:flex; justify-content:space-between; margin-bottom:12px; color:#374151; }
  .summary-total { font-weight:800; font-size:1.05rem; }
  .btn-checkout { width:100%; background:linear-gradient(90deg,#ff7b00,#ff6b35); color:#fff; padding:12px; border-radius:10px; border:none; font-weight:800; cursor:pointer; }
  .empty { text-align:center; padding:40px 20px; color:#6b7280; }
  @media (max-width:900px){ .cart-wrap{ flex-direction:column; } .cart-summary{ width:100%; } }
</style>

<div class="cart-wrap">
  <div class="cart-items">
    <h2>Your Cart</h2>

    <% if (cartItems && cartItems.length > 0) { %>

      <% let subtotal = 0; %>

      <% cartItems.forEach(function(item){ 
           subtotal += item.price * item.qty; 
      %>

      <div class="cart-item">
        <div class="ci-thumb">
          <img src="<%= item.imageUrl %>" alt="<%= item.name %>" />
        </div>

        <div class="ci-body">
          <div class="ci-title"><%= item.name %></div>
          <div class="ci-meta">Price: $<%= item.price.toFixed(2) %></div>
        </div>

        <div class="ci-actions">
          <form action="/cart/update" method="POST" style="display:flex; gap:8px; align-items:center;">
            <input type="hidden" name="id" value="<%= item._id %>">
            <input class="qty-input" type="number" name="qty" value="<%= item.qty %>" min="1">
            <button class="btn-sm btn-update" type="submit">Update</button>
          </form>

          <form action="/cart/remove" method="POST">
            <input type="hidden" name="id" value="<%= item._id %>">
            <button class="btn-sm btn-remove" type="submit">Remove</button>
          </form>
        </div>
      </div>

      <% }) %>

    <% } else { %>

      <div class="empty">
        <h3>Your cart is empty</h3>
        <p>Looks like you haven't added anything yet.</p>
        <a href="/api/food/menu" class="btn-checkout" 
           style="display:inline-block;width:auto;padding:10px 18px;margin-top:12px;">
          Shop now
        </a>
      </div>

    <% } %>
  </div>

  <aside class="cart-summary">
    <h3>Order summary</h3>

    <% 
      let subtotal = 0;
      if (cartItems && cartItems.length) {
        cartItems.forEach(i => subtotal += i.price * i.qty);
      }
    %>

    <div class="summary-row">
      <div>Subtotal</div>
      <div>$<%= subtotal.toFixed(2) %></div>
    </div>

    <div class="summary-row summary-total">
      <div>Total</div>
      <div>$<%= subtotal.toFixed(2) %></div>
    </div>

    <form action="/checkout" method="GET">
      <button class="btn-checkout" type="submit"
        <%= (!cartItems || cartItems.length === 0) ? "disabled" : "" %>>
        Proceed to checkout
      </button>
    </form>
  </aside>
</div>
